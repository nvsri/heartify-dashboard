<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Heartify Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-body">
  <header class="dashboard-header">
    <h1>â¤ï¸ Heartify Dashboard</h1>
    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
  </header>

  <div class="dashboard-wrapper">
    <!-- sidebar -->
    <aside class="sidebar">
      <div class="card profile-card">
        <img src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="avatar" class="avatar">
        <h3 class="username">{{ username }}</h3>
        <p>Age: 24</p>
        <p>Gender: Male</p>
        <p class="health-score">Health Score: <strong>86 / 100</strong></p>
      </div>

      <div class="card tips-card">
        <h4>ğŸ’¡ Health Tip</h4>
        <p id="health-tip">Get 7-8 hours of sleep ğŸ˜´</p>
      </div>

      <div class="card report-card">
        <h4>ğŸ“„ Generate Report</h4>
        <form action="{{ url_for('generate_report') }}" method="POST">
          <button type="submit" class="download-pdf-btn">Download PDF</button>
        </form>
      </div>
    </aside>

    <!-- main -->
    <main class="main-content">
      <section class="welcome">
        <h2>Welcome, {{ username }}!</h2>
        <p>Track your health and predict your heart disease risk with <strong>Heartify</strong>.</p>
      </section>

      <section class="summary-cards">
        <div class="stat-card">
          <i class="fa-solid fa-heart-pulse stat-icon"></i>
          <h4>Heart Rate</h4>
          <p class="stat-value">72 bpm</p>
        </div>
        <div class="stat-card">
          <i class="fa-solid fa-stethoscope stat-icon"></i>
          <h4>Blood Pressure</h4>
          <p class="stat-value">120 / 80 mmHg</p>
        </div>
        <div class="stat-card">
          <i class="fa-solid fa-syringe stat-icon"></i>
          <h4>Sugar Level</h4>
          <p class="stat-value">95 mg/dL</p>
        </div>
        <div class="stat-card">
          <i class="fa-solid fa-smoking stat-icon"></i>
          <h4>Smoking Status</h4>
          <p class="stat-value">Non-Smoker ğŸš­</p>
        </div>
      </section>

      <section class="form-section">
        <h3 class="form-title">ğŸ©º Enter Health Data</h3>
        <form method="POST" action="{{ url_for('submit_health_data') }}" class="health-form">
          <input type="number" name="heart_rate" placeholder="Age / Heart Rate (bpm)" required>
          <input type="text" name="bp_level" placeholder="Blood Pressure (e.g., 120/80)" required>
          <input type="number" name="sugar_level" placeholder="Sugar Level (mg/dL)" required>
          <input type="number" name="pulse_rate" placeholder="Pulse Rate" required>
          <select name="smoker_status" required>
            <option value="">Smoker?</option>
            <option>No</option>
            <option>Yes</option>
          </select>
          <button type="submit" class="save-btn">Save Data</button>
        </form>
      </section>

      <section class="records-section">
        <h3>Your Saved Records</h3>
        {% if records %}
          <table class="records-table">
            <thead><tr><th>Heart Rate</th><th>BP</th><th>Sugar</th><th>Smoker</th></tr></thead>
            <tbody>
              {% for r in records %}
                <tr>
                  <td>{{ r.heart_rate }}</td>
                  <td>{{ r.bp_level }}</td>
                  <td>{{ r.sugar_level }}</td>
                  <td>{{ r.smoker_status }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="no-records">No saved records yet.</p>
        {% endif %}
      </section>
    </main>
  </div>

  <script>
    const tips = [
      "Get 7-8 hours of sleep ğŸ˜´",
      "Walk 30 minutes daily ğŸš¶â€â™‚ï¸",
      "Avoid smoking and excessive sugar ğŸš­",
      "Eat more fruits and vegetables ğŸ",
      "Drink enough water ğŸ’§"
    ];
    document.getElementById('health-tip').innerText = tips[Math.floor(Math.random()*tips.length)];
  </script>
  <!-- CHATBOT BUTTON -->
  <div id="chatbot-btn" class="chatbot-btn">ğŸ’¬</div>

  <!-- CHATBOT WINDOW -->
  <div id="chatbot-box" style="display:none;">
    <div id="chatbot-header">Heartify Chatbot
      <button id="chat-clear" class="chat-clear-btn" title="Clear chat">Clear</button>
      <span id="chatbot-close" class="chat-close-btn" title="Close chat">âœ–</span>
    </div>
    <div id="chatbot-messages"></div>

      <!-- scroll controls and quick FAQ buttons -->
  <!-- scroll buttons removed; use native scrollbar in message pane -->

      <div id="chatbot-input-area">
      <input id="chatbot-input" type="text" placeholder="Ask a question...">
      <button id="chatbot-send">Send</button>
      </div>
  </div>

  <script>
  document.getElementById("chatbot-btn").onclick = function() {
    document.getElementById("chatbot-box").style.display = "block";
    document.getElementById("chatbot-input").focus();
    // Send initial greeting once when opening
    const box = document.getElementById("chatbot-messages");
    if (box.children.length === 0) {
      fetch("/chatbot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: "hello" })
      })
      .then(resp => resp.json())
      .then(data => addBotMessage(data.reply))
      .catch(err => addBotMessage("Sorry, something went wrong."));
    }
  };

  document.getElementById("chatbot-close").onclick = function() {
    document.getElementById("chatbot-box").style.display = "none";
  };

  document.getElementById("chatbot-send").onclick = sendMsg;
  document.getElementById("chatbot-input").addEventListener("keypress", function(e) {
    if (e.key === "Enter") sendMsg();
  });

  // Clear chat button
  document.getElementById('chat-clear').onclick = function() {
    const box = document.getElementById('chatbot-messages');
    box.innerHTML = '';
  }

  // (Quick FAQ buttons removed) â€” side scroll controls remain

  function sendMsg() {
    let msg = document.getElementById("chatbot-input").value;
    if (!msg.trim()) return;
    addUserMessage(msg);

    fetch("/chatbot", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: msg })
    })
    .then(resp => {
      if (!resp.ok) throw new Error('network');
      return resp.json();
    })
    .then(data => addBotMessage(data.reply))
    .catch(err => addBotMessage("Sorry, something went wrong."));

    document.getElementById("chatbot-input").value = "";
  }
  function addUserMessage(txt) {
    const box = document.getElementById("chatbot-messages");
    const el = document.createElement('div');
    el.className = 'user-msg';
    el.textContent = txt;
    box.appendChild(el);
    box.scrollTop = box.scrollHeight;
  }

  function addBotMessage(txt) {
    const box = document.getElementById("chatbot-messages");
    const el = document.createElement('div');
    el.className = 'bot-msg';
    el.textContent = txt;
    box.appendChild(el);
    box.scrollTop = box.scrollHeight;
  }
  </script>

</body>
</html>
